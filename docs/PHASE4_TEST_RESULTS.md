# Phase 4 테스트 결과 및 다음 단계 백로그

> **작성일**: 2025-01-XX  
> **목적**: Phase 4 완료 후 실제 시나리오 테스트 결과 및 개선 포인트 정리

---

## 테스트 케이스 결과

### ✅ 케이스 1: 새우깡 (기본 시나리오)
**입력**: `"새우깡 5,000봉지 미국에 4달러에 팔거야"`

**결과**:
- ✅ Origin: South Korea (올바름)
- ✅ Destination: United States (올바름)
- ✅ Landed Cost: $0.47/unit (합리적)
- ✅ Margin: 88.3% (높지만 합리적 - 저가 제품)
- ✅ Success Probability: 63.8%
- ✅ Overall Risk: 36.2/100
- Fallback: freight, extra_costs, reference_transactions

**평가**: ✅ **정상 작동** - 모든 값이 합리적 범위

---

### ⚠️ 케이스 2: 농심 신라면
**입력**: `"농심 신라면 10,000봉지 미국에 3달러에 팔 거야"`

**결과**:
- ✅ Origin: South Korea (농심 키워드 감지 성공)
- ✅ Destination: United States
- ⚠️ Landed Cost: $2.60/unit (소매 $3 대비 87% → **너무 높음**)
- ⚠️ Margin: 13.5% (너무 낮음)
- ⚠️ Success Probability: 57.8% (낮은 편)
- ⚠️ Overall Risk: 42.2/100
- ⚠️ **이슈**: 랜디드 코스트가 소매 가격의 87% → 실제로는 $0.30-0.50 정도가 합리적

**평가**: ⚠️ **랜디드 코스트 계산 오류 의심** - 제품 가격 대비 비현실적으로 높음

---

### ⚠️ 케이스 3: 초코파이 (EU 시장)
**입력**: `"초코파이 8,000박스 독일에 2.5유로에 팔 거야"`

**결과**:
- ✅ Origin: South Korea (초코파이 키워드 감지 성공)
- ✅ Destination: Germany (올바름)
- ⚠️ **소매 가격 파싱 실패**: 2.5유로 → null (기본값 $5 사용)
- ⚠️ Landed Cost: $2.60/unit (기본값 $5 기준으로는 합리적)
- ⚠️ Margin: 48.1% (기본값 기준)
- ⚠️ **이슈**: 유로(€) 통화 파싱 안 됨, 실제 소매가 반영 안 됨

**평가**: ⚠️ **통화 파싱 이슈** - 유로/엔 등 다중 통화 지원 필요

---

### ✅ 케이스 4: 불닭볶음면
**입력**: `"삼양 불닭볶음면 20,000봉지 미국에 4.5달러"`

**결과**:
- ✅ Origin: South Korea (삼양 키워드 감지 성공)
- ✅ Destination: United States
- ⚠️ Landed Cost: $2.60/unit (소매 $4.5 대비 58% → **높은 편**)
- ⚠️ Margin: 42.3% (합리적)
- ⚠️ Compliance Risk: 0.0/100 (**너무 낮음** - 매운맛 제품은 FDA 규제 가능)
- ✅ Success Probability: 63.8%
- ✅ Overall Risk: 36.2/100

**평가**: ⚠️ **규제 리스크 과소평가** - 매운맛/식품 제품은 compliance_risk가 더 높아야 함

---

### ⚠️ 케이스 5: 라면 (일본 시장)
**입력**: `"라면 5000박스 일본에 300엔에 팔 거야"`

**결과**:
- ✅ Origin: South Korea (라면 키워드 감지 성공 - 예상보다 잘 작동!)
- ✅ Destination: Japan (올바름)
- ⚠️ **소매 가격 파싱 실패**: 300엔 → null (기본값 $5 사용)
- ⚠️ Landed Cost: $2.60/unit (기본값 기준)
- ⚠️ Margin: 48.1% (기본값 기준)
- ⚠️ **이슈**: 엔(¥) 통화 파싱 안 됨, 실제 소매가 반영 안 됨

**평가**: ⚠️ **통화 파싱 이슈** - 엔 통화 지원 필요

---

## 발견된 이슈 (테스트 결과 기반)

### 🔴 Critical Issues (즉시 수정 필요)

1. **랜디드 코스트 계산 오류 (농심 신라면 케이스)**
   - 소매 $3인데 랜디드 코스트 $2.60 (87%) → 비현실적
   - 실제로는 $0.30-0.50 정도가 합리적
   - **원인**: 제품별 무게/비용 추정 로직 문제 가능성
   - **영향**: 저가 제품($1-5)의 마진이 비현실적으로 낮게 나옴

2. **통화 파싱 실패 (초코파이, 라면 케이스)**
   - "2.5유로" → null (기본값 $5 사용)
   - "300엔" → null (기본값 $5 사용)
   - **영향**: EU/일본 시장 분석 정확도 저하

### ⚠️ Medium Priority Issues

3. **규제 리스크 과소평가 (불닭볶음면 케이스)**
   - 매운맛 제품인데 compliance_risk = 0.0/100
   - 실제로는 FDA 규제 가능성 있음
   - **영향**: 식품 제품의 실제 리스크를 과소평가

4. **EU/일본 국가 매핑**
   - ✅ "독일" → "Germany" (이미 작동)
   - ✅ "일본" → "Japan" (이미 작동)
   - ⚠️ "영국", "프랑스" 등 추가 국가 필요

### 📝 Low Priority (향후 개선)

5. **채널별 마진 기준 차별화**
   - 편의점: 40% 미만이면 "No-Go"
   - 마트/도매: 30% 미만이면 "No-Go"
   - DTC: 50% 미만이면 "No-Go"

6. **Verdict 문구 개선**
   - 성공확률 > 70% + 마진 > 50% → "Strong Go"
   - 성공확률 40-70% → "조건부 Go (원가 협상 필요)"
   - 그 아래 → "No-Go"

---

## 다음 단계 백로그 (Phase 5+)

### 🔴 Priority 1: Critical Fixes (즉시 수정)

#### 1.1 랜디드 코스트 계산 오류 수정
**문제**: 저가 제품($1-5)의 랜디드 코스트가 비현실적으로 높게 계산됨
- 예: 신라면 $3 소매 → 랜디드 $2.60 (87%) → 실제로는 $0.30-0.50이 합리적

**원인 추정**:
- `_estimate_weight()` 함수가 제품별 무게를 잘못 추정
- 또는 shipping_cost 계산 시 volume discount 미반영
- 또는 fallback freight_rate가 너무 높음

**수정 방안**:
- 제품별 무게 데이터베이스 확장 (라면, 과자 등)
- 저가 제품의 shipping cost 계산 로직 개선
- retail_price 대비 랜디드 코스트 비율 sanity check 추가

#### 1.2 통화 파싱 지원 (유로, 엔)
**문제**: "2.5유로", "300엔" 같은 통화가 파싱 안 됨

**수정 방안**:
- `_extract_retail_price()` 함수에 다중 통화 패턴 추가
- 통화 변환 로직 추가 (EUR → USD, JPY → USD)
- 환율은 환경변수 또는 API로 가져오기

---

### ⚠️ Priority 2: Medium Priority

#### 2.1 규제 리스크 개선
**문제**: 매운맛/식품 제품의 compliance_risk가 0.0으로 나옴

**수정 방안**:
- `core/risk_scoring.py`의 `_compute_compliance_risk()` 함수 개선
- "불닭", "매운맛", "spicy" 키워드 감지 시 FDA 규제 리스크 추가
- 식품 제품 카테고리별 규제 강도 차별화

#### 2.2 EU/일본 국가 매핑 확장
**현재 상태**: "독일" → "Germany", "일본" → "Japan" 작동 중
**추가 필요**: "영국", "프랑스", "이탈리아", "스페인" 등

---

### 📝 Priority 3: 향후 개선

#### 3.1 채널별 마진 기준 차별화
- 편의점: 40% 미만이면 "No-Go"
- 마트/도매: 30% 미만이면 "No-Go"
- DTC: 50% 미만이면 "No-Go"
- Amazon FBA: 35% 미만이면 "No-Go" (FBA 수수료 고려)

#### 3.2 Verdict 문구 개선
- 성공확률 > 70% + 마진 > 50% → "Strong Go"
- 성공확률 40-70% → "조건부 Go (원가 협상 필요)"
- 그 아래 → "No-Go"

#### 3.3 다중 통화 UI 지원
- USD/KRW/€/¥ 표시 옵션
- 실시간 환율 변환

---

## 테스트 결과 요약

### ✅ 잘 작동하는 것
1. **Origin/Destination 파싱**: 한국 제품 키워드 감지 완벽
2. **기본 시나리오 (새우깡)**: 모든 수치가 합리적
3. **UI 연결**: 새로운 필드들이 모두 표시됨
4. **디버그 모드**: ShipmentSpec/AnalysisResult JSON 확인 가능

### ⚠️ 개선 필요한 것
1. **저가 제품 랜디드 코스트**: $1-5 제품의 계산이 비현실적
2. **통화 파싱**: 유로/엔 지원 필요
3. **규제 리스크**: 식품 제품의 compliance_risk 과소평가

---

## 테스트 체크리스트

각 케이스마다 확인할 사항:

- [ ] Origin/Destination 올바르게 파싱되는가?
- [ ] Landed Cost가 합리적인 범위인가? (제품 가격의 10-50% 수준)
- [ ] Margin이 너무 극단적이지 않은가? (0-100% 범위 내)
- [ ] Success Probability가 합리적인가? (30-90% 범위)
- [ ] Risk Score가 극단적이지 않은가? (0-100 범위)
- [ ] Data Quality 탭에서 Fallback이 적절한가? (모든 항목 fallback이면 문제)

---

## 실행 방법

### CLI 테스트
```bash
python scripts/run_sample_analysis.py "새우깡 5,000봉지 미국에 4달러에 팔거야"
```

### Streamlit 테스트
```bash
streamlit run app.py
# 또는
python -m streamlit run app.py
```

브라우저에서:
1. Analyze 페이지에 입력
2. Results 페이지에서 확인
3. 사이드바 "Show debug info" 활성화하여 JSON 확인

---

## 메모

- 이상한 케이스 발견 시 이 문서에 추가
- "이건 수치가 좀 구리다" 싶은 케이스만 메모
- 다음 Cursor/Roo 작업의 재료로 활용

